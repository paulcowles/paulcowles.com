<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Shared folder permissions between an OS X Host and an Ubuntu VM (501 dialout?!)</title>
        <meta name="viewport" content="width=device-width">
        
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">paulcowles.com</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Shared folder permissions between an OS X Host and an Ubuntu VM (501 dialout?!)</h2>
<p class="meta">01 Feb 2014</p>

<div class="post">
<p>We use VMWare Fusion to streamline development environments for projects and clients. In general each product, app or client has their own self contained virtual machine. On that VM is a the full stack, typically running on an Ubuntu linux OS. This allows us to do a number of things quickly and efficiently - sharing environments, onboarding, archiving, backups, etc. </p>

<p>We use the VMWare Shared Directories function to share our host sourcecode directory to the guest OS. This allows us to work on the host using whatever editors, IDEs, tools we choose and the guest OS picks up changes instantly as if edits were done locally on the guest OS.</p>

<p>VMWare Fusion for Mac (we&#39;re using 6.0.2) has an issue with how it handles permissions for these shared directories, and apparently it has been around for a while. The issue is that the guest OS (Ubuntu) sees directory onwership as the uid and gid of your OSX account. The default uid for the first account on your Mac OS X is 501 and so you will most likely see the files and directories similar to below:</p>

<div class="highlight"><pre><code class="sh">paulcowles@ubuntu:/<span class="nv">$ </span>ls -al /mnt/hgfs
drwxr-xr-x 1 501 dialout 1836 Jan 22 12:42 sourcecode
</code></pre></div>

<p>In most cases, 501 won&#39;t be a valid uid on the guest OS (it wasn&#39;t for us). This doesn&#39;t usually cause problems, but sometimes you need ownership by a valid user. For example, if you need Apache running as www-data to be able to write to the shared directory.</p>

<p>To get the host and guest working together better, we need to make sure there is an account on your linux VM with same uid and that this user is part of the www-data group that your Apache typically operates as.</p>

<p>For this scenario, our Mac OS X user is &quot;paulcowles&quot; and we login to the Ubuntu guest as &quot;paulcowles&quot; which is a user account with sudo access. We also have another account setup on the Ubuntu guest &quot;admin&quot; that has sudo access.</p>

<p>On our Ubuntu VM confirm the uid</p>

<div class="highlight"><pre><code class="sh">paulcowles@ubuntu:/<span class="nv">$ </span>id
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>paulcowles<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>paulcowles<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>paulcowles<span class="o">)</span>...
</code></pre></div>

<p>On our Mac confirm the uid (verify it is 501)</p>

<div class="highlight"><pre><code class="sh">Pauls-MacBook-Pro:~ paulcowles<span class="nv">$ </span>id
<span class="nv">uid</span><span class="o">=</span>501<span class="o">(</span>paulcowles<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>20<span class="o">(</span>staff<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>20<span class="o">(</span>staff<span class="o">)</span>...
</code></pre></div>

<p>Login as the &quot;secondary&quot; admin account on your VM. Assuming our usual account for development on VM matches our Mac and is &quot;paulcowles&quot; then let&#39;s logout of paulcowles and login as admin</p>

<div class="highlight"><pre><code class="sh">Pauls-MacBook-Pro:~ paulcowles<span class="nv">$ </span>ssh admin@192.168.2.85
</code></pre></div>

<p>Make sure our primary development account on linux is a member of the www-data group Apache is using</p>

<div class="highlight"><pre><code class="sh">admin@ubuntu:/<span class="nv">$ </span>sudo adduser paulcowles www-data
</code></pre></div>

<p>Change the uid of the paulcowles account on our Ubuntu VM. It is a good idea to take a VM snapshot before mucking with uid changes just in case you need to rollback.</p>

<div class="highlight"><pre><code class="sh">admin@ubuntu:/<span class="nv">$ </span>sudo usermod -u 501 paulcowles
admin@ubuntu:/<span class="nv">$ </span>sudo find / -user 1000 -exec chown -h 501 <span class="o">{}</span> <span class="se">\;</span>
</code></pre></div>

<p><em>Note</em> 501 is the uid we want the account to have (to match our OS X host) and 1000 was the old uid</p>

<p>Reboot and check again</p>

<div class="highlight"><pre><code class="sh">admin@ubuntu:/<span class="nv">$ </span>sudo reboot
</code></pre></div>

<p>Then</p>

<div class="highlight"><pre><code class="sh">Pauls-MacBook-Pro:~ paulcowles<span class="nv">$ </span>ssh paulcowles@192.168.2.85
paulcowles@ubuntu:/<span class="nv">$ </span>ls -al /mnt/hgfs
total 11
dr-xr-xr-x 1 root       root    4192 Jan 31 14:47 .
drwxr-xr-x 4 root       root    4096 Jun 21  2013 ..
drwxr-xr-x 1 paulcowles dialout 1836 Jan 22 12:42 sourcecode
</code></pre></div>

<p>Notice 501 has changed to paulcowles. Now Apache and your local account should jive nicely and Apache should be able to write to your shared directory. paulcowles on OS X and paulcowles on Ubuntu both have the uid 501. paulcowles on Ubuntu is part of the www-data group, same as Apache, so everyone can read and write to the directory without error. </p>

</div>


          <div class="footer">
            <div class="contact">
              <p>
                Paul Cowles<br />
                Technology Leader<br />
                paul.cowles@gmail.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/paulcowles">github.com/paulcowles</a><br />
                <a href="https://twitter.com/paulrc">twitter.com/paulrc</a><br />
                <a href="https://dl.dropboxusercontent.com/u/186173/life/index.html">curriculum vitae</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
